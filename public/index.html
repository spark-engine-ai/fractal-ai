<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fractal Engine - AI Cognitive Intelligence</title>
    <link href="./styles/output.css" rel="stylesheet">
</head>
<body class="bg-fractal-dark text-white h-screen overflow-hidden">

<style>
  .hide-scrollbar::-webkit-scrollbar { display: none; }
  .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

  .control-panel {
    border-radius: 0.5rem;
    border: 1px solid rgb(75 85 99 / 1);
    background-color: rgb(26 26 26 / 1);
    padding: 1rem;
  }

  .cp-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
    user-select: none;
  }

  .cp-content {
    overflow: hidden;
    max-height: 0;
    padding-top: 0;        /* collapsed = no padding */
    transition: max-height 200ms ease, padding-top 200ms ease;
  }

.control-panel[data-open="true"] .cp-content {
  max-height: 1000px;
  padding-top: 1rem;   /* space between header & first item */
  display: flex;
  flex-direction: column;
  gap: 0rem;           /* vertical spacing between children */
}


  .cp-toggle svg {
    transition: transform 150ms ease;
  }
  .control-panel[data-open="true"] .cp-toggle svg {
    transform: rotate(180deg);
  }
</style>

    <div class="h-full flex">
        <!-- Left Sidebar - Controls -->
    <div class="w-80 bg-fractal-gray border-r border-gray-600">
      <div class="p-6 space-y-6 flex-1 min-h-0">
        <div class="flex items-center mb-6 gap-4">
          <img src="./images/logo.PNG" alt="Fractal Engine Logo" width="24" height="24" style="transform: translate(0px, 4px)" class="mt-2 rounded">
          <h1 class="text-md font-bold text-white mt-2" style="transform: translate(5px, 4px)">Fractal Engine</h1>
        </div>

        <!-- This is the scroller -->
<div class="flex-1 overflow-y-auto pr-6 pb-8 space-y-4 hide-scrollbar" style="height:88vh;">

  <!-- Session Controls -->
        <div class="control-panel cp" data-open="true">
          <div class="cp-header flex items-center justify-between cursor-pointer select-none">
            <div class="flex items-center">
                <div>
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="16"  height="16"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-world-plus"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M20.985 12.518a9 9 0 1 0 -8.45 8.466" /><path d="M3.6 9h16.8" /><path d="M3.6 15h11.4" /><path d="M11.5 3a17 17 0 0 0 0 18" /><path d="M12.5 3a16.998 16.998 0 0 1 2.283 12.157" /><path d="M16 19h6" /><path d="M19 16v6" /></svg>
                </div>
                <h2 class="text-sm font-semibold" style="padding-left:5px;">Session</h2>
            </div>
            <button class="cp-toggle text-gray-300 hover:text-white" aria-expanded="true" aria-controls="cp-session">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div id="cp-session" class="cp-content space-y-4">
            <div class="mt-12 top-4">
              <input type="text" id="goalInput"
                     placeholder="Enter your goal..."
                     class="w-full p-2 bg-fractal-dark border border-gray-500 rounded text-white text-sm">
            </div>
            <button id="newSessionBtn" style="--tw-bg-opacity: 0.5;" class="btn-secondary w-full mt-8 bg-black hover:bg-black border-fractal-blue">New Session</button>
          </div>
        </div>

                <!-- API Configuration -->
        <div class="control-panel cp" data-open="false">
          <div class="cp-header flex items-center justify-between cursor-pointer select-none">
            <div class="flex items-center">
                <div>
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="16"  height="16"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-key"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M16.555 3.843l3.602 3.602a2.877 2.877 0 0 1 0 4.069l-2.643 2.643a2.877 2.877 0 0 1 -4.069 0l-.301 -.301l-6.558 6.558a2 2 0 0 1 -1.239 .578l-.175 .008h-1.172a1 1 0 0 1 -.993 -.883l-.007 -.117v-1.172a2 2 0 0 1 .467 -1.284l.119 -.13l.414 -.414h2v-2h2v-2l2.144 -2.144l-.301 -.301a2.877 2.877 0 0 1 0 -4.069l2.643 -2.643a2.877 2.877 0 0 1 4.069 0z" /><path d="M15 9h.01" /></svg>                
                </div>
                <h2 class="text-sm font-semibold" style="padding-left:5px;">API Configuration</h2>
            </div>
            <button class="cp-toggle text-gray-300 hover:text-white" aria-expanded="false" aria-controls="cp-api">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div id="cp-api" class="cp-content mt-3 space-y-3">
            <div>
              <input type="password" id="apiKeyInput"
                     placeholder="Enter OpenAI API key here..."
                     class="w-full p-2 bg-fractal-dark border border-gray-500 rounded text-white text-xs">
              <div class="text-xs text-white mt-1" style="opacity:0.35;">This overrides the server API key</div>
            </div>
          </div>
        </div>

        <!-- Fractal Controls -->
        <div class="control-panel cp" data-open="true">
          <div class="cp-header flex items-center justify-between cursor-pointer select-none">
            <div class="flex items-center">
                <div>
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="16"  height="16"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-topology-star-3"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 19a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z" /><path d="M18 5a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z" /><path d="M10 5a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z" /><path d="M6 12a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z" /><path d="M18 19a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z" /><path d="M14 12a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z" /><path d="M22 12a2 2 0 1 0 -4 0a2 2 0 0 0 4 0z" /><path d="M6 12h4" /><path d="M14 12h4" /><path d="M15 7l-2 3" /><path d="M9 7l2 3" /><path d="M11 14l-2 3" /><path d="M13 14l2 3" /></svg>                
                </div>
                <h2 class="text-sm font-semibold" style="padding-left:5px;">Fractal Parameters</h2>
            </div>
            <button class="cp-toggle text-gray-300 hover:text-white" aria-expanded="true" aria-controls="cp-fractal">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div id="cp-fractal" class="cp-content mt-3 space-y-4">
            <div>
              <label class="block text-xs font-medium mb-1">
                Depth: <span id="depthValue">3</span>
              </label>
              <input type="range" id="depthSlider" min="1" max="8" value="3"
                     class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
              <div class="flex justify-between text-[10px] text-gray-400 mt-1">
                <span>1</span><span>8</span>
              </div>
            </div>

            <div>
              <label class="block text-xs font-medium mb-1">
                Length: <span id="lengthValue">3</span>
              </label>
              <input type="range" id="lengthSlider" min="1" max="8" value="3"
                     class="w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer">
              <div class="flex justify-between text-[10px] text-gray-400 mt-1">
                <span>1</span><span>8</span>
              </div>
            </div>

            <p class="text-xs text-gray-400">
              Total Agents: <span id="agentCount">13</span>
            </p>
          </div>
        </div>

        <!-- Modifiers Controls -->
        <div class="control-panel cp" data-open="true">
          <div class="cp-header flex items-center justify-between cursor-pointer select-none">
            <div class="flex items-center">
                <div>
                    <svg  xmlns="http://www.w3.org/2000/svg"  width="16"  height="16"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-adjustments-horizontal"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 6l8 0" /><path d="M16 6l4 0" /><path d="M8 12m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 12l2 0" /><path d="M10 12l10 0" /><path d="M17 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" /><path d="M4 18l11 0" /><path d="M19 18l1 0" /></svg>
                </div>
                <h2 class="text-sm font-semibold" style="padding-left:5px;">Modifiers</h2>
            </div>
            <button class="cp-toggle text-gray-300 hover:text-white" aria-expanded="true" aria-controls="cp-modifiers">
              <svg width="14" height="14" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                <path d="M5 8l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          <div id="cp-modifiers" class="cp-content mt-3 space-y-4">
            <div class="relative">
              <label class="block text-xs font-medium mb-2">Fractal Pattern</label>
              
              <!-- Custom Dropdown -->
              <div id="customDropdown" class="relative">
                <!-- Dropdown Button -->
                <button id="dropdownBtn" class="w-full p-2 bg-fractal-dark border border-gray-500 rounded text-white text-sm flex items-center justify-between cursor-pointer hover:border-gray-400 transition-colors">
                  <div class="flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-line">
                      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                      <path d="M6 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                      <path d="M18 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                      <path d="M7.5 16.5l9 -9" />
                    </svg>
                    <span id="selectedModifier" style="margin-left:5px;">Flat</span>
                  </div>
                  <svg width="11" height="11" class="transition-transform" id="dropdownArrow" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                  </svg>
                </button>
                
              </div>
            </div>
            
            <div id="modifierPreview" class="text-xs text-gray-400">
              Pattern: [3, 3, 3]
            </div>
          </div>
        </div>

                        <!-- Dropdown Menu -->
                <div id="dropdownMenu" style="width:240px;transform:translate(1vw, -45vh);" class="absolute top-full left-0 bottom-0 mt-1 bg-fractal-dark border border-gray-500 rounded shadow-lg z-50 hidden">
                  
                  <!-- Flat Option -->
                  <div class="dropdown-option relative p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0" data-value="flat">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-line">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M6 18m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                          <path d="M18 6m-2 0a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
                          <path d="M7.5 16.5l9 -9" />
                        </svg>
                        <span class="text-sm" style="margin-left:6px;">Flat</span>
                      </div>
                      <div class="info-icon-container relative">
                        <svg class="info-icon text-gray-400 hover:text-white transition-colors" xmlns="http://www.w3.org/2000/svg" width="22" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M12 9h.01" />
                          <path d="M11 12h1v4h1" />
                        </svg>
                        <div style="width:320px" class="tooltip-popup absolute bg-black w-full bottom-full right-0 mb-2 bg-gray-800 text-white text-xs rounded-lg p-2 shadow-lg border border-gray-600 hidden">
                          Every layer has the same number of agents. Example: [3, 3, 3]
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Add Option -->
                  <div class="dropdown-option relative p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0" data-value="add">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-code-plus">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M9 12h6" />
                          <path d="M12 9v6" />
                          <path d="M6 19a2 2 0 0 1 -2 -2v-4l-1 -1l1 -1v-4a2 2 0 0 1 2 -2" />
                          <path d="M18 19a2 2 0 0 0 2 -2v-4l1 -1l-1 -1v-4a2 2 0 0 0 -2 -2" />
                        </svg>
                        <span class="text-sm" style="margin-left:6px;">Add</span>
                      </div>
                      <div class="info-icon-container relative">
                        <svg class="info-icon text-gray-400 hover:text-white transition-colors" xmlns="http://www.w3.org/2000/svg" width="22" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M12 9h.01" />
                          <path d="M11 12h1v4h1" />
                        </svg>
                        <div style="width:320px"  class="bg-black tooltip-popup absolute bottom-full right-0 mb-2 bg-gray-800 text-white text-xs rounded-lg p-2 shadow-lg border border-gray-600 hidden whitespace-nowrap">
                          Starts small and increases each layer until the final layer matches the base length
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Subtract Option -->
                  <div class="dropdown-option relative p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0" data-value="subtract">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-code-minus">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M9 12h6" />
                          <path d="M6 19a2 2 0 0 1 -2 -2v-4l-1 -1l1 -1v-4a2 2 0 0 1 2 -2" />
                          <path d="M18 19a2 2 0 0 0 2 -2v-4l1 -1l-1 -1v-4a2 2 0 0 0 -2 -2" />
                        </svg>
                        <span class="text-sm" style="margin-left:6px;">Subtract</span>
                      </div>
                      <div class="info-icon-container relative">
                        <svg class="info-icon text-gray-400 hover:text-white transition-colors" xmlns="http://www.w3.org/2000/svg" width="22" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M12 9h.01" />
                          <path d="M11 12h1v4h1" />
                        </svg>
                        <div style="width:320px"  class="bg-black tooltip-popup absolute bottom-full right-0 mb-2 bg-gray-800 text-white text-xs rounded-lg p-2 shadow-lg border border-gray-600 hidden whitespace-nowrap">
                          Starts at the maximum number of agents and gets smaller each layer until it reaches 1
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Grow Divided Option -->
                  <div class="dropdown-option relative p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0" data-value="grow_divided">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-maximize">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M16 4l4 0l0 4" />
                          <path d="M14 10l6 -6" />
                          <path d="M8 20l-4 0l0 -4" />
                          <path d="M4 20l6 -6" />
                          <path d="M16 20l4 0l0 -4" />
                          <path d="M14 14l6 6" />
                          <path d="M8 4l-4 0l0 4" />
                          <path d="M4 4l6 6" />
                        </svg>
                        <span class="text-sm" style="margin-left:6px;">Grow Divided</span>
                      </div>
                      <div class="info-icon-container relative">
                        <svg class="info-icon text-gray-400 hover:text-white transition-colors" xmlns="http://www.w3.org/2000/svg" width="22" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M12 9h.01" />
                          <path d="M11 12h1v4h1" />
                        </svg>
                        <div style="width:320px"  class="bg-black tooltip-popup absolute bottom-full right-0 mb-2 bg-gray-800 text-white text-xs rounded-lg p-2 shadow-lg border border-gray-600 hidden whitespace-nowrap">
                          The opposite of Shrink divided, ending at the base length. Example: [1, 2, 2, 3, 4, 8]
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  <!-- Shrink Divided Option -->
                  <div class="dropdown-option relative p-3 hover:bg-gray-700 cursor-pointer border-b border-gray-600 last:border-b-0" data-value="shrink_divided">
                    <div class="flex items-center justify-between">
                      <div class="flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-arrows-minimize">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M5 9l4 0l0 -4" />
                          <path d="M3 3l6 6" />
                          <path d="M5 15l4 0l0 4" />
                          <path d="M3 21l6 -6" />
                          <path d="M19 9l-4 0l0 -4" />
                          <path d="M15 9l6 -6" />
                          <path d="M19 15l-4 0l0 4" />
                          <path d="M15 15l6 6" />
                        </svg>
                        <span class="text-sm" style="margin-left:6px;">Shrink Divided</span>
                      </div>
                      <div class="info-icon-container relative">
                        <svg class="info-icon text-gray-400 hover:text-white transition-colors" xmlns="http://www.w3.org/2000/svg" width="22" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
                          <path d="M12 9h.01" />
                          <path d="M11 12h1v4h1" />
                        </svg>
                        <div style="width:320px"  class="bg-black tooltip-popup absolute bottom-full right-0 mb-2 bg-gray-800 text-white text-xs rounded-lg p-2 shadow-lg border border-gray-600 hidden whitespace-nowrap">
                          Each layer equals base length divided by its layer number. Example: [8, 4, 3, 2, 2, 1]
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
            
</div>

            </div>
        </div>

        <!-- Main Content Area -->
        <div class="flex-1 flex flex-col h-full overflow-hidden">
            <!-- Top Bar -->
            <div class="bg-fractal-gray border-b border-gray-600 p-4 flex-shrink-0">
                <div class="flex justify-between items-center" style="transform: translateY(3.5px)">
                    <h2 class="text-xl font-semibold">Cognitive Interface</h2>
                    <div class="flex space-x-4">
                        <button id="chatTabBtn" class="btn-secondary active">Chat</button>
                        <button id="consoleTabBtn" class="btn-secondary">Console</button>
                        <button id="toggleViewBtn" class="btn-secondary">3D View</button>
                        <button id="clearChatBtn" class="btn-secondary">Clear Chat</button>
                    </div>
                </div>
            </div>

            <!-- Chat Interface -->
            <div id="chatView" class="flex-1 flex flex-col">
                <div id="chatMessages" class="overflow-y-auto p-6 space-y-4" style="height: 75vh;">
                    <!-- Welcome Screen - Will be replaced when session starts -->
                    <div id="welcomeScreen" class="flex flex-col items-center justify-center h-full text-center">
                        <div class="flex items-center align-center justify-center mb-6 gap-4">

                        <img src="./images/logo.PNG" style="transform:translateX(-7.5px)" alt="Fractal Engine Logo" width="44" height="44" class="rounded-lg shadow-lg">
                        <h1 style="font-size: 30px;" class="font-bold text-white">Fractal Engine</h1>
                        </div>
                        <div style="height:0.5px;opacity:0.5;background-color:white;width:20vw;margin-bottom:12px;"></div>
                        <p class="text-md text-gray-300 mb-2">AI-Powered Cognitive Intelligence</p>
                        <p class="text-gray-400 text-sm mb-8 max-w-md text-center w-80" style="text-align:center" >Experience recursive AI reasoning through fractal agent processing. Set your parameters and create a new session to begin.</p>
                    </div>
                </div>

                <!-- Chat Input -->
                <div class="border-gray-600 p-4">
                    <div class="flex space-x-4 justify-center">
                        <input type="text" id="chatInput" 
                               placeholder="Ask me anything..."
                               style="width:50vw;"
                               class="flex p-3 bg-fractal-gray border border-gray-500 rounded-lg text-white">
                        <button id="sendBtn" class="btn-secondary bg-white text-white px-6">
 <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-arrow-up"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M18 11l-6 -6" /><path d="M6 11l6 -6" /></svg>                           

                        </button>
                    </div>
                </div>
            </div>

            <!-- Console Interface -->
            <div id="consoleView" class="flex-1 flex flex-col hidden">
                <div class="overflow-y-auto p-6" style="height: 75vh;">
                    <div id="consoleContent" class="space-y-6">
                        <div class="text-gray-400 text-center py-8">
                            <p>Console logs will appear here when fractal processing occurs.</p>
                            <p class="text-sm mt-2">Execute a complex query to see the fractal system in action.</p>
                        </div>
                    </div>
                </div>
                <div class="border-t border-gray-600 p-4">
                    <button id="clearConsoleBtn" class="btn-secondary">Clear Console</button>
                </div>
            </div>

            <!-- Node Graph View -->
            <div id="nodeView" class="flex-1 hidden">
                <div class="h-full bg-fractal-dark relative overflow-hidden">
                    <canvas id="nodeCanvas" class="w-full h-full"></canvas>
                    <div id="nodeInfo" class="absolute top-4 left-4 bg-fractal-gray rounded-lg border border-gray-600 max-w-sm transition-all duration-300 z-10">
                        <div class="flex items-center justify-between p-3 cursor-pointer" id="nodeInfoHeader">
                            <h3 class="font-semibold text-sm pr-4 mr-4">Agent Fractal Info  </h3>
                            <button id="toggleInfoBtn" class="text-gray-400 hover:text-white text-lg pl-4 leading-none">â–¾</button>
                        </div>
                        <div id="nodeInfoContent" class="p-4">
                            <p class="text-sm text-gray-400">Interactive visualization will appear here when processing queries.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
        <div class="bg-fractal-gray p-6 rounded-lg border border-gray-600">
            <div class="flex items-center space-x-3">
                <div class="animate-spin-slow w-6 h-6 border-2 border-fractal-blue border-t-transparent rounded-full"></div>
                <span>Processing through fractal layers...</span>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- Removed external markdown library - using custom parser -->
    <script src="./js/app.js"></script>
    <script>
  (function () {
    const panels = document.querySelectorAll('.cp');
    panels.forEach((panel, idx) => {
      const header = panel.querySelector('.cp-header');
      const toggleBtn = panel.querySelector('.cp-toggle');
      const content = panel.querySelector('.cp-content');

      // Ensure ARIA wiring if missing
      if (!content.id) content.id = `cp-${idx}`;
      toggleBtn?.setAttribute('aria-controls', content.id);

      function setOpen(open) {
        panel.dataset.open = open ? 'true' : 'false';
        toggleBtn?.setAttribute('aria-expanded', String(open));
        // If you want pixel-perfect max-height, uncomment below:
        // content.style.maxHeight = open ? content.scrollHeight + 'px' : '0px';
      }

      // Initialize based on data-open
      setOpen(panel.dataset.open !== 'false');

      // Click anywhere on header toggles
      header.addEventListener('click', () => {
        const isOpen = panel.dataset.open === 'true';
        setOpen(!isOpen);
      });

      // Keep height correct if window resizes while open (only needed if using pixel max-height)
      // window.addEventListener('resize', () => {
      //   if (panel.dataset.open === 'true') {
      //     content.style.maxHeight = content.scrollHeight + 'px';
      //   }
      // });
    });
  })();
</script>

</body>
</html>